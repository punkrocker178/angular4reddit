<div class="card" [ngClass]="{'custom-card': !isDetail, 'mb-5': !isDetail, 'custom-card-no-border': isDetail}">
  <div class="card-body crop-content" [ngClass]="{'mb-3': isDetail}">

    <div class="card-side-padding">
      <!-- Subreddit - author - post date -->
      <div (click)="viewDetail()" class="d-flex flex-row post-author">
        <a [routerLink]="'/' + post?.data['subreddit_name_prefixed']" [replaceUrl]="true" [routerLinkActive]="'active'"
          class="me-auto">{{post?.data['subreddit_name_prefixed']}}</a>
        <a [routerLink]="'/u/' + post?.data['author']" [routerLinkActive]="'active'">by /u/{{post?.data['author']}}</a>
        <span [title]="post.data['created_utc'] | dateTimePipe: 'format'" class="ms-2">{{ post.data['created_utc'] |
          dateTimePipe: 'diff' }}</span>
      </div>

      <!-- Awards -->
      <ng-container *ngIf="post.data['all_awardings'] && post.data['all_awardings'].length > 0">
        <app-award [isDetail]="isDetail" [awards]="post.data['all_awardings']"></app-award>
      </ng-container>

      <div class="mb-3">
        <h5 (click)="viewDetail()" class="card-title mb-2 d-inline-block me-2">{{post?.data['title'] | replacePipe}}
        </h5>

        <!-- Flair -->
        <ng-container *ngIf="flairText">
          <div (click)="filterByFlair()" #flairElement class="flair-text">
            <img *ngIf="flairEmoji" class="emoji-flair" [src]="flairEmoji">
            <span>{{flairText}}</span>
          </div>

        </ng-container>

        <div *ngIf="isOver18()">
          <span class="nsfw-text">NSFW</span>
        </div>
      </div>

      <ng-container *ngIf="isCrossPost()">
        <h5>Crosspost: {{post.data['crosspost_parent']}}</h5>
      </ng-container>
    </div>

    <ng-container *ngIf="imageSrc">
      <div [ngClass]="{'crop-height': !isDetail, 'blur-img': isOver18() && !over18_consent}" class="img-container">
        <img (click)="viewDetail()" class="img-fluid center-img scale-img" [src]="imageSrc | replacePipe">
      </div>
    </ng-container>

    <ng-container *ngIf="galleryData.items.length > 0">
      <app-gallery [data]="galleryData" [configs]="galleryConfigs"></app-gallery>
    </ng-container>

    <ng-container *ngIf="isVideo()">

      <!-- Video thumbnail container -->
      <ng-container *ngIf="!isInitVideoErr && (!isMediaEmbed() && !isEmbededLink())">
        <div (click)="playVideo()" *ngIf="!isInitVideo" 
        class="letter-box-color d-flex video-thumbnail-container">
          <span class="icon-before icon-play play-video-btn"></span>
          <img class="video-thumbnail" *ngIf="videoThumbnailSrc" [src]="videoThumbnailSrc | replacePipe">
        </div>
      </ng-container>

      <!-- Video error message -->
      <div *ngIf="isInitVideoErr" class="letter-box-color scale-media d-flex">
        <span class="video-thumbnail">{{videoPlayerError}}</span>
      </div>

      <!-- Video player -->
      <div [hidden]="!isInitVideo" [ngClass]="{'blur-img': isOver18() && !over18_consent}"
        [ngClass]="{'ratio-16x9': isWidescreenVideo, 'ratio-4x3': !isWidescreenVideo}" class="scale-media ratio">
        <video *ngIf="!isEmbededLink() && !isMediaEmbed()" #videoPlayer preload="metadata" controls autoplay
          class="letter-box-color">
        </video>
      </div>

      <!-- Iframe -->
      <div *ngIf="isEmbededLink() || isMediaEmbed()"
        [ngClass]="{'blur-img': isOver18() && !over18_consent, 'ratio-16x9': isWidescreenVideo, 'ratio-4x3': !isWidescreenVideo}"
        class="scale-media ratio">
        <iframe [src]="videoSrc | safe: 'resourceUrl'"></iframe>
      </div>

    </ng-container>

    <!-- Link & thumbnail -->
    <div class="card-side-padding" *ngIf="isEmbededLink() || noSelfText">
      <a class="d-flex flex-row flex-wrap" [href]="post.data['url']" target="_blank">
        <span class="w-100 me-auto">{{ post.data['url'] }}</span>
        <img class="" *ngIf="post.data['thumbnail']" [src]="post.data['thumbnail'] | replacePipe">
      </a>
    </div>

    <ng-container *ngIf="isTwitchEmbedded() && !noSelfText">
      <div class="scale-media ratio ratio-16x9">
        <iframe class="embedly-embed" allowfullscreen="true" [src]="embedSrc | safe: 'resourceUrl'"></iframe>
      </div>
    </ng-container>


    <div class="d-flex justify-content-center" #twitterEmbed *ngIf="isEmbededLink() && isTwitterEmbedded()">
    </div>

    <!-- Post text content -->
    <ng-container *ngIf="!isComment(); else commentBlock">
      <div (click)="viewDetail()" class="parsed-html card-side-padding" appHTML
        [selfText]="post?.data['selftext_html']">
      </div>
    </ng-container>

    <ng-template #commentBlock>
      <div class="card-side-padding">
        <span>Commented on <a target="_blank" [href]="post.data['link_url']"
            class="fw-bold">{{post.data['link_title']}}</a></span>
        <div (click)="viewDetail(true)" class="post-comments parsed-html-comments" appHTML
          [selfText]="post?.data['body_html']"></div>
      </div>

    </ng-template>

  </div>

  <!-- Vote - Comments - Share section -->
  <div class="card-footer d-flex button-group">
    <app-vote [score]="post?.data['score']" [id]="post?.data['name']" [liked]="post?.data['likes']"></app-vote>

    <div (click)="viewDetail()" class="p-2 post-buttons align-self-center flex-fill">
      <button class="btn custom-btn d-md-none">
        <span class="fw-bold me-2">{{post?.data['num_comments']}}</span>
        <i class="fas fa-comment-dots"></i>
      </button>

      <button class="btn custom-btn d-none d-md-inline">
        <span class="fw-bold">{{post?.data['num_comments']}}</span>
        Comments
      </button>
    </div>

    <div class="p-2 post-buttons align-self-center flex-fill">
      <button *ngIf="!isSaved; else unsaveBtn" (click)="save()" class="btn custom-btn">
        <i class="far fa-bookmark me-1"></i>
        <span class="d-none d-md-inline">Save</span>
      </button>

    </div>

    <div class="p-2 post-buttons align-self-center flex-fill">
      <button (click)="share(toastClipboardCopied)" class="btn custom-btn">
        <i class="fas fa-share-alt me-1"></i>
        <span class="d-none d-md-inline">Share</span>
      </button>
    </div>

    <ng-template #unsaveBtn>
      <button (click)="unsave()" class="btn custom-btn">
        <i class="fas fa-bookmark me-1"></i>
        <span class="d-none d-md-inline">Unsave</span>
      </button>
    </ng-template>

  </div>
</div>

<ng-template #toastClipboardCopied>
  Link copied to clipboard (ᵔᴥᵔ)
</ng-template>